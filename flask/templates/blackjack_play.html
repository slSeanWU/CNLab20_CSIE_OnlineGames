<!DOCTYPE HTML>
<meta charset="UTF-8">
<title>CSIE Online Games: BlackJack</title>

<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){
            namespace = '/test';
            var socket = io(namespace);

            socket.on('connect', function(){
                socket.emit('connect_event', {data: 'I\'m connected!'});
            });

            socket.on('start', function(msg){
                document.getElementById("player").innerHTML=msg.player;
                document.getElementById("dealer").innerHTML=msg.dealer;
                $('form#take').find(':input[type=submit]').prop('disabled', false);
                $('form#stop').find(':input[type=submit]').prop('disabled', false);
                document.getElementById("log").innerHTML='';
                $('#log').append('<br>' + $('<div/>').text('Received #: Start a new game.').html());
            });

            socket.on('server_response', function(msg, cb){
                $('#log').append('<br>' + $('<div/>').text('Received #' + ': ' + msg.data).html());
                if(cb)
                    cb();
            });

            socket.on('player_picked', function(msg){
                $('#log').append('<br>' + $('<div/>').text('Received #: Player drew a card.').html());
                document.getElementById("player").innerHTML=msg.cards;
            });

            socket.on('player_bust', function(){
                $('#log').append('<br>' + $('<div/>').text('Player Bust!').html());
                $('form#take').find(':input[type=submit]').prop('disabled', true);
                $('form#stop').find(':input[type=submit]').prop('disabled', true);
                socket.emit('player_stop');
            });

            socket.on('dealer_picked', function(msg){
                $('#log').append('<br>' + $('<div/>').text('Received #: Dealer drew cards.').html());
                document.getElementById("dealer").innerHTML=msg.cards;
                if(msg.total > 21){
                    $('#log').append('<br>' + $('<div/>').text('Dealer Bust!').html());
                }
            });

            $('form#emit').submit(function(event){
                socket.emit('client_event', {data: $('#emit_data').val()});
                return false;
            });

            $('form#disconnect').submit(function(event){
                socket.emit('disconnect_request');
                return false;
            });

            $('form#start').submit(function(event){
                socket.emit('start_game');
                return false;
            });

            $('form#take').submit(function(event){
                socket.emit('player_take_one');
                return false;
            });

            $('form#stop').submit(function(event){
                $('form#take').find(':input[type=submit]').prop('disabled', true);
                $('form#stop').find(':input[type=submit]').prop('disabled', true);
                socket.emit('player_stop');
                return false;
            });

        })
    </script>
</head>
<body>
    <div id="head">
      <h1>CSIE Online Games --- BlackJack</h1>
      <h4>User: {{ username }} <br> Coins: {{ coins }}</h4>
    </div>

    <p>Async mode is: <b>{{ async_mode }}</b></p>
    <h2>Logs:</h2>
    <div id="log"></div>
    <h2>Send:</h2>
<!--    
    <form id = "emit" method="POST" action='#'>
        <input type="text" name="emit_data" id="emit_data" placeholder="Message">
        <input type="submit" value="Echo">
    </form>
    <form id = "disconnect" method="POST" action="#">
        <input type="submit" value="Disconnect">
    </form>
-->
    <form id = "start" method="POST" action="#">
        <input type="submit" value="Start">
    </form>
    <form id = "take" method="POST" action="#">
        <input type="submit" value="Take" disabled>
    </form>
    <form id = "stop" method="POST" action="#">
        <input type="submit" value="Stop" disabled>
    </form>
    <h2>Player:</h2>
    <div id="player"></div>
    <h2>Dealer:</h2>
    <div id="dealer"></div>

    <div id="go-back">
        <p>Feel tired? <br>
          <a href="/main_menu">
            <button>Leave game</button>
          </a>
        </p>
      </div>
</body>
</html>